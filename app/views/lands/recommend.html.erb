<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>
<!-- includes ends -->


<div class="row"></div>
<div class="row">
	<div class="col-lg-8">
		<div style='width: 800px;'>
		  <div id="sidebar_builder" style=' height: 400px;'></div>
		</div>
	</div>
	<div class="col-lg-4">
		<div id='sidebar_container'>
		</div>
	</div>
</div>

	<script type="text/javascript">
	// top 5 positions are marked on map
	function createSidebarLi(json){
  		var s = "<li><a class=show_location><img height = 50 width=50 src=/assets/real_estate_filler.jpg />" + json.name + "</a><br><a class=show_nearby_places>Show nearby places</a></li>";
  		return s;
	};

function bindLiToMarker($li, marker){
  $li.find("a.show_location").on('click', function(){
    handler.getMap().setZoom(14);
    marker.setMap(handler.getMap()); //because clusterer removes map property from marker
    marker.panTo();
    google.maps.event.trigger(marker.getServiceObject(), 'click');
  })
  $li.find("a.show_nearby_places").on('click', function(){
    alert("nearby_places")
    // handler.getMap().setZoom(14);
    // marker.setMap(handler.getMap()); //because clusterer removes map property from marker
    // marker.panTo();
    // google.maps.event.trigger(marker.getServiceObject(), 'click');
  })
};

function createSidebar(json_array){
  _.each(json_array, function(json){
    var $li = $( createSidebarLi(json) );
    $li.appendTo('#sidebar_container');
    bindLiToMarker($li, json.marker);
  });
};

handler = Gmaps.build('Google');
handler.buildMap({ internal: {id: 'sidebar_builder'}}, function(){
  var json_array = [
    { lat: 40, lng: -80, name: 'loc1', rating: "9", rating_splittage: "5,4,1", nearby_places: [{type: "restaurant", lat: 41, lng: -81}, {type: "theatre", lat: 42, lng: -82}] },
    { lat: 45, lng: -90, name: 'loc2', rating: "8", rating_splittage: "3,3,2", nearby_places: [{type: "restaurant", lat: 41, lng: -81}, {type: "theatre", lat: 42, lng: -82}] },
    { lat: 50, lng: -85, name: 'loc3', rating: "6", rating_splittage: "2,2,2", nearby_places: [{type: "restaurant", lat: 41, lng: -81}, {type: "theatre", lat: 42, lng: -82}] }
  ];

  var markers = handler.addMarkers(json_array);

  _.each(json_array, function(json, index){
    json.marker = markers[index];
  });

  createSidebar(json_array);
  handler.bounds.extendWith(markers);
  handler.fitMapToBounds();
});

</script>


<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
  <%#=
  @lands = []
  5.times { |i|
    @lands << Land.new({id: i, name: "item#{i}"})
  }
  render @lands
  %>
</div>